
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorer - EconoViz</title>
    <link rel="stylesheet" href="explorer.css">
    <link rel="stylesheet" href="../css/logout.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Logout Button -->
    <button class="logout-btn" id="logoutBtn">
        <svg viewBox="0 0 24 24">
            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        <span>Logout</span>
    </button>

    <!-- Error Notification Popup -->
    <div class="error-popup" id="errorPopup">
        <div class="error-content">
            <svg viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <span id="errorMessage">Logout failed due to an error</span>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                </div>
                <h3>Confirm Logout</h3>
                <p>Are you sure you want to logout?</p>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelLogoutBtn">Cancel</button>
                <button class="btn-confirm" id="confirmLogoutBtn">
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Country Selection Modal -->
    <div class="modal-overlay" id="countryModal" style="display: none;">
        <div class="modal-content country-modal-content">
            <div class="modal-header">
                <h3>Select a Country</h3>
                <button class="modal-close-btn" id="closeCountryModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="country-search" placeholder="Search country..." class="country-search-input">
                <ul id="country-list" class="country-list">
                    <!-- Country options will be populated here -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Back Button: moved outside explorer-content for instant load -->
    <div class="explorer-back-btn-container">
        <button class="explorer-back-btn" id="backToMetricBtn">&#8592; Choose a different metric</button>
    </div>

    <main class="main-content">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading metric details...</p>
        </div>

        <!-- Error State -->
        <div id="error" class="error">
            <svg viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <p id="errorMessage">Failed to load metric details</p>
            <button id="retryBtn" class="retry-btn">Retry</button>
        </div>

        <!-- Main Explorer Content -->
        <div id="explorer-content" class="explorer-content" style="display: none;">
            <!-- Page Header -->
            <div class="page-header">
                <h1 id="metric-title">Loading...</h1>
                <div class="metric-description" id="metric-description"></div>
            </div>

            <!-- Controls Section -->
            <div class="controls-section">
                <div class="controls-grid">
                    <!-- Date Range Controls -->
                    <div class="date-controls">
                        <div class="date-input-group">
                            <label for="from-year">From</label>
                            <input type="number" id="from-year" value="1961" min="1960" max="2030">
                        </div>
                        <div class="date-input-group">
                            <label for="to-year">To</label>
                            <input type="number" id="to-year" value="2023" min="1960" max="2030">
                        </div>
                    </div>

                    <!-- Add Country Button -->
                    <button class="add-country-btn" id="add-country-btn">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        Add Country
                    </button>

                    <!-- Country Selection Modal -->
                    <div class="modal-overlay" id="countryModal" style="display: none;">
                        <div class="modal-content country-modal-content">
                            <div class="modal-header">
                                <h3>Select a Country</h3>
                                <button class="modal-close-btn" id="closeCountryModal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <input type="text" id="country-search" placeholder="Search country..." class="country-search-input">
                                <ul id="country-list" class="country-list">
                                    <!-- Country options will be populated here -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- View Toggle Buttons -->
                    <div class="view-toggle">
                        <button class="toggle-btn active" id="chart-view-btn" title="Chart View">
                            <svg viewBox="0 0 24 24">
                                <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                            </svg>
                        </button>
                        <button class="toggle-btn" id="histogram-view-btn" title="Histogram">
                            <svg viewBox="0 0 24 24">
                                <path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Selected Countries -->
            <div class="countries-section">
                <div class="section-title">
                    Selected Countries
                    <span class="country-count" id="country-count">0 countries</span>
                </div>
                <div class="selected-countries" id="selected-countries">
                    <!-- Countries will be added here dynamically -->
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-section">
                <div class="chart-header">
                    <h3>Data Visualization</h3>
                </div>
                <div class="chart-container" id="chart-container">
                    <div class="chart-placeholder">
                        <svg class="chart-icon" viewBox="0 0 24 24">
                            <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                        </svg>
                        <h4>Chart Ready</h4>
                        <p>Your data visualization will appear here once countries are selected.</p>
                        <small>Chart integration coming soon</small>
                    </div>
                </div>
            </div>

            <!-- Download Button -->
            <button class="download-btn" id="download-csv-btn" title="Download CSV data for the selected countries">
                Download CSV
            </button>

            <!-- Key Figures Section - moved to bottom -->
            <div class="key-figures-section" id="key-figures-section" style="display: none;">
                <div class="section-title-with-period">
                    <h3 class="section-title">ðŸ“Š Key Figures</h3>
                    <span class="period-badge" id="key-figures-period">2015â€“2023</span>
                </div>
                <div class="key-figures-grid" id="key-figures-grid">
                    <div class="key-figure-card average-card">
                        <div class="key-figure-icon">ðŸ“ˆ</div>
                        <div class="key-figure-content">
                            <div class="key-figure-label">Average</div>
                            <div class="key-figure-value" id="average-value">--</div>
                        </div>
                    </div>
                    <div class="key-figure-card minimum-card">
                        <div class="key-figure-icon">ðŸ“‰</div>
                        <div class="key-figure-content">
                            <div class="key-figure-label">Minimum</div>
                            <div class="key-figure-value" id="minimum-value">--</div>
                            <div class="key-figure-detail" id="minimum-detail">--</div>
                        </div>
                    </div>
                    <div class="key-figure-card maximum-card">
                        <div class="key-figure-icon">ðŸŽ¯</div>
                        <div class="key-figure-content">
                            <div class="key-figure-label">Maximum</div>
                            <div class="key-figure-value" id="maximum-value">--</div>
                            <div class="key-figure-detail" id="maximum-detail">--</div>
                        </div>
                    </div>
                    <div class="key-figure-card change-card">
                        <div class="key-figure-icon">ðŸ”„</div>
                        <div class="key-figure-content">
                            <div class="key-figure-label">Overall Change</div>
                            <div class="key-figure-value" id="change-value">--</div>
                            <div class="key-figure-detail" id="change-detail">--</div>
                        </div>
                    </div>
                    <div class="key-figure-card trend-card">
                        <div class="key-figure-icon" id="trend-icon">ðŸ“Š</div>
                        <div class="key-figure-content">
                            <div class="key-figure-label">Trend</div>
                            <div class="key-figure-value" id="trend-value">--</div>
                            <div class="key-figure-detail" id="trend-detail">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module" src="chartjs-loader.js"></script>
    <script src="../js/logout.js"></script>
    <script type="module" src="explorer.js"></script>
</body>
</html>
